<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Login / Sign Up</title>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-50 to-white flex items-center justify-center p-6">

  <div class="w-full max-w-lg bg-white rounded-2xl shadow-2xl overflow-hidden">
    <!-- Header -->
    <div class="bg-indigo-600 p-6 text-center">
      <h1 class="text-3xl font-bold text-white">MyApp</h1>
      <p class="mt-1 text-indigo-200">Welcome, please login or sign up</p>
    </div>
    <!-- Tabs -->
    <div class="flex bg-gray-100">
      <button id="tab-login" class="flex-1 py-3 text-center font-semibold transition-colors duration-200">Login</button>
      <button id="tab-signup" class="flex-1 py-3 text-center font-semibold text-gray-500 hover:text-indigo-600 transition-colors duration-200">Sign Up</button>
    </div>

    <div class="p-8">
      <!-- Login Form -->
      <form id="form-login" class="space-y-6">
        <div>
          <label for="login-username" class="block text-sm font-medium text-gray-700">Username</label>
          <input id="login-username" type="text" required
                 class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition"/>
        </div>
        <div>
          <label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
          <input id="login-password" type="password" required
                 class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition"/>
        </div>
        <div id="login-error" class="text-red-500 text-sm hidden"></div>
        <button type="submit" class="w-full py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition">Sign In</button>
      </form>
      <!-- Sign Up Form -->
      <form id="form-signup" class="space-y-6 hidden">
        <div>
          <label for="signup-username" class="block text-sm font-medium text-gray-700">Username</label>
          <input id="signup-username" type="text" required
                 class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition"/>
        </div>
        <div>
          <label for="signup-email" class="block text-sm font-medium text-gray-700">Email</label>
          <input id="signup-email" type="email" required
                 class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition"/>
        </div>
        <div>
          <label for="signup-password" class="block text-sm font-medium text-gray-700">Password</label>
          <input id="signup-password" type="password" required
                 class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition"/>
        </div>
        <div id="signup-error" class="text-red-500 text-sm hidden"></div>
        <button type="submit" class="w-full py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition">Create Account</button>
      </form>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl w-full max-w-md p-8 space-y-6">
      <h2 class="text-2xl font-bold text-gray-800">Enter Verification Code</h2>
      <p class="text-gray-600">We sent a 6-digit code to your email. Please enter it below.</p>
      <input id="verify-code" type="text" maxlength="6" required placeholder="123456"
             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition"/>
      <div id="verify-error" class="text-red-500 text-sm hidden"></div>
      <div class="flex justify-end space-x-4">
        <button id="btn-close" class="px-6 py-2 bg-gray-200 rounded-lg font-medium hover:bg-gray-300 transition">Cancel</button>
        <button id="btn-verify" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition">Verify</button>
      </div>
    </div>
  </div>

  <script>
    const BASE_URL = 'http://localhost';

    // Element references
    const signupUsername = document.getElementById('signup-username');
    const signupPassword = document.getElementById('signup-password');
    const signupEmail    = document.getElementById('signup-email');
    const loginUsername  = document.getElementById('login-username');
    const loginPassword  = document.getElementById('login-password');
    const tabLogin       = document.getElementById('tab-login');
    const tabSignup      = document.getElementById('tab-signup');
    const formLogin      = document.getElementById('form-login');
    const formSignup     = document.getElementById('form-signup');
    const modal          = document.getElementById('modal');
    const btnClose       = document.getElementById('btn-close');
    const btnVerify      = document.getElementById('btn-verify');
    const verifyCode     = document.getElementById('verify-code');
    const loginError     = document.getElementById('login-error');
    const signupError    = document.getElementById('signup-error');
    const verifyError    = document.getElementById('verify-error');

    let pendingSignup = {};

    // Tab switching
    function activateTab(tab) {
      if (tab === 'login') {
        formLogin.classList.remove('hidden');
        formSignup.classList.add('hidden');
        tabLogin.classList.add('border-b-4','border-indigo-600','text-indigo-600');
        tabSignup.classList.remove('border-b-4','border-indigo-600','text-indigo-600');
      } else {
        formLogin.classList.add('hidden');
        formSignup.classList.remove('hidden');
        tabSignup.classList.add('border-b-4','border-indigo-600','text-indigo-600');
        tabLogin.classList.remove('border-b-4','border-indigo-600','text-indigo-600');
      }
    }

    tabLogin.addEventListener('click', () => activateTab('login'));
    tabSignup.addEventListener('click', () => activateTab('signup'));

    // Sign-up flow
    formSignup.addEventListener('submit', async e => {
      e.preventDefault();
      signupError.classList.add('hidden');
      try {
        const res = await fetch(`${BASE_URL}/api/user/signup`, {
          method: 'POST', headers: {'Content-Type':'application/json'},
          body: JSON.stringify({username: signupUsername.value.trim(), password: signupPassword.value, email: signupEmail.value.trim()})
        });
        const data = await res.json(); if (!res.ok) throw new Error(data.message);
        pendingSignup = {username: signupUsername.value.trim(), password: signupPassword.value};
        activateTab('signup'); // keep sign-up tab
        modal.classList.remove('hidden');
      } catch(err) {
        signupError.textContent = err.message || 'Error'; signupError.classList.remove('hidden');
      }
    });

    btnClose.addEventListener('click', () => { modal.classList.add('hidden'); verifyError.classList.add('hidden'); });

    // Verification flow
    btnVerify.addEventListener('click', async () => {
      verifyError.classList.add('hidden');
      const code = verifyCode.value.trim();
      if (code.length !== 6) { verifyError.textContent = 'Enter 6-digit code'; verifyError.classList.remove('hidden'); return; }
      try {
        const res = await fetch(`${BASE_URL}/api/user/verify-account?username=${encodeURIComponent(pendingSignup.username)}`, {
          method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({code})
        });
        const data = await res.json(); if (!res.ok) throw new Error(data.message);
        modal.classList.add('hidden'); activateTab('login');
        loginUsername.value = pendingSignup.username; loginPassword.value = pendingSignup.password;
      } catch(err) {
        verifyError.textContent = err.message || 'Invalid code'; verifyError.classList.remove('hidden');
      }
    });

    // Login flow
    formLogin.addEventListener('submit', async e => {
      e.preventDefault(); loginError.classList.add('hidden');
      try {
        const res = await fetch(`${BASE_URL}/api/user/login`, {
          method: 'POST', headers: {'Content-Type':'application/json'},
          body: JSON.stringify({username: loginUsername.value.trim(), password: loginPassword.value})
        });
        const data = await res.json(); if (!res.ok) throw new Error(data.message);
        window.location.href = 'dashboard.html';
      } catch(err) {
        loginError.textContent = err.message || 'Error'; loginError.classList.remove('hidden');
      }
    });
  </script>
</body>
</html>
